#
# This tests the generated CONFIG header, that it exists and compiles
#
#   #include <autotools.autoconf.Config.hypogeal.twilight.CONFIG>
#
default:
all check clean distclean realclean:

default: all
all: check

TOP = ../..

# recall: the token progression is: c++0x c++1y c++1z c++2a.
# expect the gcc7-series.
STDCXX = -std=c++1z
MODULES = $(TOP)/modules
INCLUDE = $(TOP)/include

SHOWCONFIG = showconfig

check: run-$(SHOWCONFIG)
$(SHOWCONFIG).o : $(MODULES)/autotools
$(SHOWCONFIG).o : $(MODULES)/autotools.autoconf
$(SHOWCONFIG).o : $(MODULES)/autotools.autoconf.Config
$(SHOWCONFIG).o : $(MODULES)/autotools.autoconf.Config.hypogeal.twilight.CONFIG # autogenerated
$(SHOWCONFIG).o : $(MODULES)/tests.quoting
$(SHOWCONFIG).o : $(SHOWCONFIG).cpp
	$(CXX) -o $@ -c $< $(STDCXX) $(CPPFLAGS) $(CXXFLAGS) -I$(MODULES) -I$(INCLUDE)
$(SHOWCONFIG) : $(SHOWCONFIG).o
	$(CXX) -o $@ $< $(LDFLAGS)
	ldd $@
clean: clean-$(SHOWCONFIG)
clean-$(SHOWCONFIG):
	rm -f $(SHOWCONFIG).o $(SHOWCONFIG)

$(MODULES)/tests.quoting : quoting.cpp
	install -c -m 444 $< $@
clean: clean-tests.quoting
clean-tests.quoting:
	rm -f $(MODULES)/tests.quoting

run: run-$(SHOWCONFIG)
run-$(SHOWCONFIG): $(SHOWCONFIG)
	./$<
