#!/bin/bash
cd ${0%/*} || exit 70

#
# WATCHOUT - this is not a standard test
# WATCHOUT - this is not a standard test - it uses --without-mysql++
# WATCHOUT - this is not a standard test
#

set -e
# PWD is expected to be .../tests/ac/SOMETHING
declare with_hypogeal_twilight=${PWD%/*/*/*}
# We're not testing buildconf, so use a "standard" one.   Any buildconf "that works" will do.
# Make it work.
if [[ ! -e ./buildconf ]] ; then
    if ! cp ../../../bc/template.autotools-style-buildconf buildconf ; then
        echo "${0}: error, could not copy a reasonable buildconf"
        exit 1
    fi 1>&2
fi
if [[ ! -x ./buildconf ]] ; then
    if ! chmod a+x ./buildconf ; then
        echo "${0}: error, could not make the buildconf executable"
        exit 1
    fi 1>&2
fi

function generate() {
    declare file=$1 ; shift
    declare tfile="$(dirname $file)/t99.$$.${RANDOM}.${file##*/}~"
    cat > ${tfile?} && chmod a-w ${tfile?} && mv ${tfile?} ${file?}
}
generate Makefile.am <<__Makefile__
# An minimal automake -*- Makefile -*-
# automatically generated by $0 at $(date --rfc-3339=seconds=seconds)
default:
__Makefile__

with_hypogeal_twilight=${with_hypogeal_twilight} ./buildconf

if [ -d /opt/nonstd/mysql++ ] ; then
    answer=/opt/nonstd/mysql++
    # and configure will expect to see package nonstd-mysql++-devel
else
    answer=no
    # and configure will expect to see package mysql++-devel
fi
./configure --with-nonstd-mysql++=$answer
