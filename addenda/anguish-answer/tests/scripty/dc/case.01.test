#!/bin/sh
source ${0%/*}/rigging.sh || exit 70
# with no other options is (not yet) an error
expected_ecode=0
# (for now) unwind the trap ... we expect this test to fail
trap '' ERR
(
    # the use of DEBUG=<value> will make the diff part of the test fail
    ${exe?} ${DEBUG:+--debug} --srcdir=${0%/*} --modulesdir=obj/modules --objdir=obj/src ${0%.test}.xcpp
) >& ${output?}
actual_ecode=$?
trap failing ERR
if ((expected_ecode != actual_ecode)); then
    echo "exit expected=${expected_ecode?} actual=${actual_ecode}"
    failing
else
    difference ${golden?} ${output?}
    successful
fi
