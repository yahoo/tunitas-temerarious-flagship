// -*- c++ -*- C++23 with S.C.O.L.D. stylings; For terms, see the LICENSE file at the top of the repository.
#divert <fpp>
#forward tests.unit.Cleanup
namespace tests {
  namespace unit {
    enum UNLINK { };
    template<> class Cleanup<UNLINK>;
  }
}
#divert </fpp>
#divert <hpp>
#import tests.unit.Cleanable
template<> class tests::unit::Cleanup<tests::unit::UNLINK> : public Cleanable {
  using ancestor = Cleanable;
public:
  using ancestor::Cleanable; // standardized constructor
  inline ~Cleanup();         // destructor unlinks (under all conditions)
};
#endiv
#divert <ipp>
#import sys.posix.unlink
tests::unit::Cleanup<tests::unit::UNLINK>::~Cleanup() {
  // Try really hard to unlink ... but if it doesn't work then we can't do anything.
  // This is a destructor so we musn't throw another exception.  Suppress.  Move on.
  sys::posix::unlink(ancestor::pathname);
}
#endiv
