# TEMPLATE - copy this into your project at .../tests/config.sh.in
# TEMPLATE - ahem, and remove the first three lines.
# TEMPLATE - the result is to be sourced at the head of a *.test script
#
# Originally this file was found at ${prefix}/share/incendiary-sophist/template.config.sh.in
#
# Notation: (see .../sysexits.sh)
#
#   116 ... EX_NOCONFIG .... (this) config.sh.in or the site-installed incendiary-sophist is missing
#   117 ... EX_NORIGGING ... the package-local rigging.sh could not be sourced
#
# Usage:
#
#   __topdir=../..
#   source ${__topdir?}/tests/config.sh || exit 117
#
# Expectations:
#
#    1. copied into your project at ./tests/config.sh.in
#
#       cd ${topdir} (of your project)
#       mkdir -p tests
#       cp /opt/scold/share/incendiary-sophist/sh/template.config.sh.in tests/config.sh.in
#
#    2. configure.ac contains
#
#         AC_CONFIG_FILES([Makefile tests/config.sh])
#
#    3. incorporate the config.sh into each unit test
#       in each unit test, e.g. $(topdir}/test/unit/TEST.test   (of your project)
#
#    3(a) using the compare_outputs method
#
#       source ${0%/*}/../../tests/config.sh &&
#       source ${incendiary_sophist_riggingdir}/sysexits.sh &&
#       source ${incendiary_sophist_riggingdir}/compare_outputs.sh ||
#       exit 116
#
#    3(b) using the exiting method
#
#       source ${0%/*}/../../tests/config.sh &&
#       source ${incendiary_sophist_riggingdir}/sysexits.sh &&
#       source ${incendiary_sophist_riggingdir}/exiting.sh ||
#       exit 116
#

# Grab the values from the autotools substitution against --with-incendiary-sophist=PREFIX

# Reminder
#   
#    exists    incendiary_sophist_prefix       @incendiary_sophist_prefix@
#    dubious   incendiary_sophist_libdir       @incendiary_sophist_libdir@
#    exists    incendiary_sophist_riggingdir   @incendiary_sophist_riggingdir@
#
# the libdir may or may not exist across different versions of incendiary-sophist
# as of incendiary-sophist v0.3, it does not exist, only riggingdir exists

incendiary_sophist_prefix=@incendiary_sophist_prefix@
incendiary_sophist_libdir=@incendiary_sophist_libdir@
incendiary_sophist_riggingdir=@incendiary_sophist_riggingdir@
# incendiary_sophist_riggingdir is inbound in a patch from hypogeal-twilight series/v0.44/04.green-copper.heron
if [[ "@"incendiary_sophist_riggingdir"@" == "${incendiary_sophist_riggingdir}" ]] ; then
    eval ${incendiary_sophist_libdir:+incendiary_sophist_riggingdir=${incendiary_sophist_libdir}/rigging}
fi

function __incendiary_sophist_complain() {
    local BADNESS=$1; shift
    local directory=$1; shift
    local location=$1; shift
    echo "$BADNESS: MISSING directory $directory at $location" 1>&2
}
function __incendiary_sophist_warn() {
    local unused_code=$1; shift
    __incendiary_sophist_complain WARNING "$@"
}
function __incendiary_sophist_fail() {
    local code=$1; shift
    __incendiary_sophist_complain ERROR "$@"
    exit $code
}
# If --without-incendiary-sophist was asserted, then unset everything
# If --with-incendiary-sophist was asserted, then crudely prove the directories exist.
function __incendiary_sophist_with_or_without_name() {
    local badness=$1; shift
    local name=$1; shift
    local subname=$1; shift
    eval "
    if test -n \"\$${name}_${subname}\" ;
    then test -d \"\$${name}_${subname}\" || __incendiary_sophist_$badness 116 \"${name}_${subname}\" \"\$${name}_${subname}\";
    else unset ${name}_${subname};
    fi"
}
function __incendiary_sophist_with_or_without() {
    # WATCHOUT - there is no incendiary_sophist_libdir in incendiary-sophist-0.2.2, only riggingdir
    # DO NOT fail on missing libdir (only warn); do fail on missing prefix or riggingdir
    __incendiary_sophist_with_or_without_name fail $1 prefix
    __incendiary_sophist_with_or_without_name warn $1 libdir
    __incendiary_sophist_with_or_without_name fail $1 riggingdir
}
function __incendiary_sophist() {
    __incendiary_sophist_with_or_without incendiary_sophist
    # and leave no trace
    unset __incendiary_sophist_with_or_without_name
    unset __incendiary_sophist_with_or_without
    unset __incendiary_sophist
    unset __incendiary_sophist_fail
    unset __incendiary_sophist_warn
    unset __incendiary_sophist_complain
}
__incendiary_sophist
